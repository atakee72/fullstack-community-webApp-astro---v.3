---
// Logout page - clears Better Auth session
import BaseLayout from '../layouts/BaseLayout.astro';
import { auth } from '../auth';

// Server-side logout
try {
  // Clear the Better Auth session properly
  await auth.api.signOut({
    headers: Astro.request.headers,
  });
} catch (error) {
  console.error('Error during server-side logout:', error);
}

// Clear all session cookies
Astro.cookies.delete('mahalle-session', {
  path: '/',
});

// Also try to delete with different paths in case of path issues
Astro.cookies.delete('better-auth.session_token', {
  path: '/',
});

// Redirect to home after logout
return Astro.redirect('/');
---

<BaseLayout title="Logging out...">
  <main class="min-h-[calc(100vh-80px)] flex items-center justify-center">
    <div class="text-center">
      <h2 class="text-2xl font-bold mb-4">Logging out...</h2>
      <p>You will be redirected shortly.</p>
    </div>
  </main>
</BaseLayout>

<script>
  // Client-side logout - clear local storage and redirect
  if (typeof window !== 'undefined') {
    // Clear all auth-related items from localStorage
    localStorage.removeItem('auth-storage');
    localStorage.removeItem('token');

    // Redirect to home
    window.location.href = '/';
  }
</script>